# Starting and Stopping Systemd Services on Raspberry Pi

This guide covers how to manage systemd services on your Raspberry Pi, with a focus on our data recorder application.

## Basic Service Management Commands

| Action | Command | Description |
|--------|---------|-------------|
| **Start** | `sudo systemctl start data-recorder.service` | Starts the service immediately |
| **Stop** | `sudo systemctl stop data-recorder.service` | Stops the service immediately |
| **Restart** | `sudo systemctl restart data-recorder.service` | Stops and then starts the service |
| **Enable** | `sudo systemctl enable data-recorder.service` | Configures the service to start on boot |
| **Disable** | `sudo systemctl disable data-recorder.service` | Prevents the service from starting on boot |
| **Status** | `sudo systemctl status data-recorder.service` | Shows the current status of the service |

## Complete Management Guide

### Starting the Service

To start the data recorder service:

```bash
sudo systemctl start data-recorder.service
```

This will immediately start the service without needing to reboot.

### Stopping the Service

To stop the data recorder service:

```bash
sudo systemctl stop data-recorder.service
```

This immediately terminates the service. Any ongoing operations will be interrupted.

### Checking Service Status

To view the current status of the service:

```bash
sudo systemctl status data-recorder.service
```

This will show:
- Whether the service is active or inactive
- Whether it's enabled or disabled for automatic startup
- Recent log entries
- Process information

### Enabling Automatic Startup

To configure the service to start automatically when the Raspberry Pi boots:

```bash
sudo systemctl enable data-recorder.service
```

### Disabling Automatic Startup

To prevent the service from starting automatically on boot:

```bash
sudo systemctl disable data-recorder.service
```

Note: This only prevents automatic startup. It doesn't affect a currently running service.

### Restarting the Service

To restart the service (useful after making changes to the code):

```bash
sudo systemctl restart data-recorder.service
```

### Reloading the Service

If your service supports reloading its configuration without fully restarting:

```bash
sudo systemctl reload data-recorder.service
```

Note: Not all services support this feature.

### Viewing Service Logs

To view the logs generated by the data recorder service:

```bash
sudo journalctl -u data-recorder.service
```

To follow the logs in real-time (similar to `tail -f`):

```bash
sudo journalctl -u data-recorder.service -f
```

To see only the most recent logs:

```bash
sudo journalctl -u data-recorder.service -n 50
```

### Advanced Options

#### Masking a Service

To completely prevent a service from being started (even manually):

```bash
sudo systemctl mask data-recorder.service
```

To undo this:

```bash
sudo systemctl unmask data-recorder.service
```

#### One-time Boot Override

To disable the service for just the next boot:

```bash
sudo systemctl disable --runtime data-recorder.service
```

#### Editing Service Configuration

To edit the service file:

```bash
sudo systemctl edit data-recorder.service
```

Or to edit the complete service file:

```bash
sudo systemctl edit --full data-recorder.service
```

After editing, reload systemd to apply changes:

```bash
sudo systemctl daemon-reload
```

## Troubleshooting

### Service Fails to Start

1. Check the status for error messages:
   ```bash
   sudo systemctl status data-recorder.service
   ```

2. Check detailed logs:
   ```bash
   sudo journalctl -u data-recorder.service -n 100
   ```

3. Verify permissions on your script:
   ```bash
   sudo chmod +x /home/rpi2/Documents/forensic/data_recorder.py
   ```

4. Check for path issues in the service file:
   ```bash
   sudo systemctl edit --full data-recorder.service
   ```

### Service Starts but Crashes

1. Run the script manually to see any error output:
   ```bash
   cd /home/rpi2/Documents/forensic
   python3 data_recorder.py
   ```

2. Check for dependencies or hardware issues:
   - Camera module enabled
   - Required Python packages installed
   - Correct permissions for accessing hardware

## Quick Reference

| Need | Command |
|------|---------|
| Start on boot + now | `sudo systemctl enable --now data-recorder.service` |
| Stop now + disable on boot | `sudo systemctl disable --now data-recorder.service` |
| Reset after changing service file | `sudo systemctl daemon-reload` |
| Full service management | `sudo systemctl --help` |